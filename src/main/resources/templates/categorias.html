<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" >
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <!-- ===== BOX ICONS ===== -->
      <link href='https://cdn.jsdelivr.net/npm/boxicons@2.0.5/css/boxicons.min.css' rel='stylesheet' />

      <!-- ===== CSS ===== -->
      <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" /> -->
      <link rel="stylesheet" href="../static/lib/bootstrap.min.css" th:href="@{/lib/bootstrap.min.css}" />
      <!-- <link rel="stylesheet" href="assets/css/bootstrap.min.css"> -->
      <link rel="stylesheet" th:href="@{/css/styles.css}" />

      <!--- Favicon --->
      <link rel="icon" type="image/svg" sizes="32x32" th:href="@{/img/favicon.svg}">

      <title>Gestor Gastos | Categorías</title>
  </head>

  <body id="body">
  <!---------------- SVG ICONS -------------------> 
    <svg style="display: none;">
      <defs>
      <!-- TopArrow -->
      <symbol id="topArrow-icon" viewBox="0 0 15 15">
        <path d="M8.2 15V3.2C9 4.4 10.8 6 12.2 7c.4 0 .9-.5.9-1a33.1 33.1 0 01-5.6-6C6.1 2 3.7 4.4 1.9 6c0 .5.3 1 .9 1C4 6 6 4.5 6.8 3.3V15z"/>
      </symbol>
      <!-- delete icon -->
      <symbol id="delete-icon" viewBox="0 0 24.5 24">
        <path d="M7.84 2.955C6.76 3.818.248 11.342.248 11.342a1 1 0 000 1.316l7 8A1 1 0 008 21h13c1.645 0 3-1.355 3-3V6c0-1.645-1.355-2.994-3-3 0 0-13.048-.135-13.16-.045zM8.453 5H21c.564 0 1 .436 1 1v12c0 .564-.436 1-1 1H8.453l-6.125-7zm9.537 2.986a1 1 0 00-.697.307L15 10.586l-2.293-2.293a1 1 0 00-.717-.303c-.897 0-1.34 1.091-.697 1.717L13.586 12l-2.293 2.293c-.982.942.472 2.396 1.414 1.414L15 13.414l2.293 2.293c.942.982 2.396-.472 1.414-1.414L16.414 12l2.293-2.293c.657-.632.195-1.742-.717-1.72z"/>
      </symbol> 
      <!-- edit icon -->
      <symbol id="edit-icon" viewBox="0 0 24 24">
        <path d="M12 19a1 1 0 100 2h9a1 1 0 100-2zM18.15 1.85a3.1 3.1 0 00-2.36.94L3.16 15.53c-.13.12-1.13 4.23-1.13 4.23a1 1 0 001.21 1.21l4.23-1.13C7.65 19.79 20.21 7.2 20.21 7.2c.67-.68 1-1.56.94-2.36a3.18 3.18 0 00-.94-2.06 3.18 3.18 0 00-2.06-.94zm-.11 2c.25 0 1.1.86 1.12 1.11.01.26-.04.51-.37.83L6.5 18.1l-2.12.54.53-2.12 12.3-12.3c.33-.33.58-.38.84-.37z"/>
      </symbol> 
      <!-- plus icon -->
      <symbol id="plus-icon" viewBox="0 0 24 24">
        <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path>
      </symbol> 
      <!-- plus circle icon -->
      <symbol id="plus-circle-icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="12"></circle><line stroke="#fff" x1="12" y1="8" x2="12" y2="16"></line><line stroke="#fff" x1="8" y1="12" x2="16" y2="12"></line> 
      </symbol> 
      <!-- plus circle fill icon -->
      <symbol id="plus-circle-fill-icon" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="12"/><path stroke="#fff" d="M12 8v8"/><path stroke="#fff" d="M8 12h8"/>
      </symbol> 
      <!-- warning icon -->
      <symbol id="warning-icon" viewBox="0 0 24 24" fill="">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"></path>
      </symbol>
      </defs>
    </svg>
    
    <!-- backTo Top btn -->
    <a href="#body" id="toTopBtn" title="hacia arriba" class="hvr-float" data-abc="true" aria-label="toTop" role="button">
      <svg class="svg-icon hvr-icon" fill="#5f2029"><use xlink:href="#topArrow-icon"></use></svg>
    </a>


    <!-- horizontal navbar (contains menu toggle icon, searchbox and profile account) -->
    <header class="header" id="header">
        <div class="header__toggle me-1">
          <i class='bx bx-menu' id="header-toggle"></i>
        </div>
        <div class="input-group input-group-sm">
          <span id="searchIcon" type="button" class="input-group-text" >
            <i id="searchSVG" class='bx bx-search nav__icon currentColor'></i>
          </span>
          <input
            id="searchBox"
            type="search"
            class="form-control"
            placeholder="Filtrar categorías o grupos..."
            aria-label="Buscar Categoria"
            onfocusout="hideSearchBox()"
            >
        </div>

      <div class="dropdown ms-4">
        <a class="" id="dropdownUserButton" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <div class="header__img">
            <img th:if="${usuarioFoto != null}" class="fotoPerfil" th:src="${'/foto/usuario/' + __${usuarioId}__}" alt="foto-perfil">
            <img th:if="${usuarioFoto == null}" th:src="@{/img/user.svg}" alt="foto-perfil">
          </div>
        </a>

          <div class="dropdown-menu" aria-labelledby="dropdownUserButton">
            <p class="dropdown-item dropdown-title fw-bold" style="color: var(--green-color)">¡Bienvenido,&nbsp;
              <span class="d-block fw-normal" th:text="|${usuarioNombre}!|"></span>
              <!-- <span class="d-block fw-normal" th:text="|${#authentication.principal.username}!|"></span> -->
            </p>
            <!-- <div class="dropdown-divider"></div> -->
              <a class="dropdown-item" style="color: #6c757d" th:href="@{cuentaUsuario}">
                <i class="bx bxs-user-circle"></i>
                <span>Mi cuenta</span>
              </a>
              <!-- <a class="dropdown-item" href="#" style="color: #6c757d"> -->
                <form th:action="@{/logout}" method="POST" class="dropdown-item d-flex align-items-center">
                  <i class="bx bx-log-out" style="color: #6c757d"></i>
                  <button class="dropdown-item" type="submit" id="logout">Cerrar Sesión</button>
                </form>

              <!-- </a> -->
          </div>
      </div>
    </header>
          
    <div id="backdropId" class="backdrop"></div>
        
    <!-- sidebar menu -->
    <div class="sidebar overflow-y-auto" id="sidebar">
      <nav id="nav-tag" class="nav">
        <div> 
          <!--  app name + logo-->
          <a id="brand" th:href="@{/}" class="nav__logo ">
            <img th:src="@{/img/logo_gastegg_blanco_sidebar.svg}" height="30"  alt="App LOGO" class="logo">
            <span id="app__name" class="ms-2 nav__logo-name">
              <img th:src="@{/img/gastegg_nombre_blanco.svg}" width="60" alt="App name" class="logo">
            </span>
            <!-- <i class='bx bx-layer nav__logo-icon'></i> -->
            <!-- <span id="app__name" class="nav__logo-name">Gestor de Gastos</span> -->
          </a>
         
          <!-- nav list container-->
          <div class="nav__list">

            <a href="#" class="nav__link">
              <i class='ocre-text bx bx-crown nav__icon'></i>
              <span class="link__name">Versión Premium</span>
            </a>

            <a href="#" th:href="@{/gastos}" class="nav__link">
              <i class='bx bx-dollar-circle nav__icon'></i>
              <span class="link__name">Gastos</span>
            </a>

            <a th:href="@{/gastos}" class="nav__link active">
              <i class='bx bx-folder nav__icon'></i>
              <span class="link__name">Categorías</span>
            </a>
                
            <a th:href="@{/estadisticas}" class="nav__link">
              <i class='bx bx-bar-chart-alt-2 nav__icon'></i>
              <span class="link__name">Estadísticas</span>
            </a>
              
            <a href="#" class="nav__link">
              <i class='bx bx-message-square-detail nav__icon'></i>
              <span class="link__name">Recordatorios</span>
            </a>
            
            <a id="newEntity" type="button"
            class="mt-2 nav__link new-entity d-table" 
            data-bs-toggle="modal"
            data-bs-target="#modal-añadir-categoria"
            >
              <span class="link__name" style="background-color: transparent;">Crear Categoría</span>
            </a>
          
            <!-- botón que se muestra en sidebar condensada -->
            <a id="newEntity-condensed" type="button"
            class="d-none mt-2 nav__link new-entity-condensed" 
            data-bs-toggle="modal"
            data-bs-target="#modal-añadir-categoria"
            >
              <i class='bx bx-plus-circle nav__icon' ></i>
              <span class="link__name" style="background-color: transparent;">Crear Categoría</span>
            </a>
          
            <!-- #logout? -->  
            <a id="logout-sidebar" href="#" class="nav__link mt-2">
              <i class='bx bx-log-out nav__icon'></i>
              <span class="link__name">Log Out</span>
            </a>
          </div> <!-- end of nav__list container--> 
        </div> 
      </nav>
    </div> <!-- sidebar end-->

    <!-- content -->
    <main>
      <div class="container-fluid">
        <br>
        <div class="card entidad__container">
          
          <div class="align-items-center d-flex justify-content-between pb-4">
            <h1 class="mt-1 entidad__title">Categorías</h1>
            <button
            title="Crear categoría"
            class="btn btn-add d-flex"
            data-bs-toggle="modal"
            data-bs-target="#modal-añadir-categoria"
            >
            <!-- onclick="resetModal()" -->
            <span class="btn-add__name align-middle mx-1">Crear categoría</span>
            <svg class="svg-icon add" focusable="false"><use xlink:href="#plus-icon"></use></svg>
            </button>
          </div>
          <span class="createGroup__link">
            <a href="#" data-bs-toggle="modal" data-bs-target="#modal-añadir-grupo">Crear grupo</a>
          </span>

          <!-- mensaje de busqueda nula -->
          <div id="searchMsg" class="d-none text-center">
            <img th:src="@{/img/search.svg}" alt="no-results-image" height="200px" loading="lazy">
            <h3  class="my-4">Sin resultados, intente nuevamente.</h3>
          </div>

        <!-- * Acá comienza el listado de categorías * -->
         
        <!-- 1ro se muestran individualmente las categorías sin agrupar-->
          <div th:each="grupo : ${gruposDeCategorias}" th:if="${grupo.nombre == 'Sin Agrupar'}">
            <div class="row" th:each="cat : ${grupo.listaCategorias}">
              <div class="col-sm-12">
                 <div class="card" th:attr="style=|background-color: hsl(${cat.color.h}, ${cat.color.s}%, 95%); color:hsl(${cat.color.h}, ${cat.color.s}%, ${cat.color.l}%); border: 1.5px solid hsl(${cat.color.h}, ${cat.color.s}%, ${cat.color.l}%)|"> 
                    <div class="card-body align-middle align-items-center d-flex justify-content-between">
                      <span th:text="${cat.nombre}"></span>
                      <div id="actions">
                        <button
                          title="Editar categoría"
                          class="btn btn-table"
                          data-bs-toggle="modal"
                          data-bs-target="#modal-editar-categoria"
                          th:attr="onclick=|fillModalCE('${cat.id}','${cat.nombre}','${grupo.id}','${cat.color.id}','0')|"
                          >
                          <!-- th:attr="onclick=|passDataEditCategoriaModal('${cat.id}','${cat.nombre}')|" -->
                          <!-- th:attr="onclick=|passDataEditCategoriaModal('${cat.id}','${cat.nombre}','${cat.color.id}','${grupo.id}')|" -->
                          <svg class="svg-icon edit"><use xlink:href="#edit-icon"></use></svg>
                        </button>
                        <button
                          title="Eliminar categoría"
                          class="btn btn-table"
                          data-bs-toggle="modal"
                          data-bs-target="#modal-eliminar-categoria"
                          th:attr="onclick=|fillModalEliminarCategoria('${cat.id}')|"
                        >
                          <svg class="svg-icon remove"><use xlink:href="#delete-icon"></use></svg>
                        </button>
                      </div>
                    </div> 
                  </div> <!-- end card -->
              </div>
            </div> <!-- end row -->
          </div> <!-- end group div -->
    
        <!-- Luego se muestran las categorías agrupadas -->
        <div class="row" th:each="grupo : ${gruposDeCategorias}" th:unless="${grupo.nombre == 'Sin Agrupar'}" th:if="${grupo.listaCategorias.size() > 0}">
          <div class="col-sm-12">
             <div class="card entidadGroup" th:attr="style=|background-color: hsl(${grupo.color.h}, ${grupo.color.s}%, 95%); color:hsl(${grupo.color.h}, ${grupo.color.s}%, ${grupo.color.l}%); border: 1.5px solid hsl(${grupo.color.h}, ${grupo.color.s}%, ${grupo.color.l}%)|"> 
                <div class="card-body group__title align-middle align-items-center d-flex justify-content-between">
                  <div>
                    <span th:text="|Grupo: ${grupo.nombre}|"></span>
                    <!-- collapse categorías button -->
                    <button
                      id="btn-collapse-categorias"
                      title="Ocultar categorías"
                      class="btn btn-table currentColor"
                      type="button"
                      data-bs-toggle="collapse"
                      th:attr="data-bs-target=|#categorias_${grupo.nombre}|"
                      aria-expanded="true"
                      aria-controls="collapseCategorias"
                    > 
                      <i class='bx bxs-chevron-up'></i>
                    </button>
                  </div>
                  
                  <div id="actions">
                    <button
                    title="Añadir categoría"
                    class="btn btn-table"
                    data-bs-toggle="modal"
                    data-bs-target="#modal-añadir-categoria"
                    th:attr="onclick=|selectGroupColorInColorPicker('${grupo.id}','${grupo.color.id}')|"
                    >
                      <svg class="svg-icon plus"><use xlink:href="#plus-circle-fill-icon"></use></svg>
                    </button>
                    <button
                    title="Editar grupo"
                    class="btn btn-table"
                    data-bs-toggle="modal"
                    data-bs-target="#modal-editar-grupo"
                    th:attr="onclick=|passDataEditGroupModal('${grupo.id}','${grupo.nombre}','${grupo.color.id}')|"
                    >
                      <svg class="svg-icon edit"><use xlink:href="#edit-icon"></use></svg>
                    </button>
                    <button
                    title="Eliminar grupo"
                    class="btn btn-table"
                    data-bs-toggle="modal"
                    data-bs-target="#modal-eliminar-grupo"
                    th:attr="onclick=|fillModalEliminarGrupo('${grupo.id}')|"
                    >
                      <svg class="svg-icon remove"><use xlink:href="#delete-icon"></use></svg>
                    </button>
                </div>
              </div>
                
                <!-- Lista categorias por grupo -->
                 <div 
                  th:id="|categorias_${grupo.nombre}|"
                  class="collapse show categorias"
                  th:attr="aria-labelledby=|categoria_${grupo.nombre}|"
                 > 
                    <hr class="divider">
                    <!--<div id="categorias_Servicios" class="collapse show categorias" aria-labelledby="headingOne">-->
                    <div th:each="cat : ${grupo.listaCategorias}" class="card-body entity align-middle align-items-center d-flex justify-content-between">
                      <span th:text="${cat.nombre}" style="margin-left: 1.1rem;"></span>
                      <div id="actions">
                        <button
                        title="Editar"
                        class="btn btn-table"
                        data-bs-toggle="modal"
                        data-bs-target="#modal-editar-categoria"
                        th:attr="onclick=|fillModalCE('${cat.id}','${cat.nombre}','${grupo.id}','${cat.color.id}','${grupo.color.id}')|"
                        >
                          <svg class="svg-icon edit"><use xlink:href="#edit-icon"></use></svg>
                        </button>
                        <button
                        title="Eliminar"
                        class="btn btn-table"
                        data-bs-toggle="modal"
                        data-bs-target="#modal-eliminar-categoria"
                        th:attr="onclick=|fillModalEliminarCategoria('${cat.id}')|"
                        >
                        <!-- th:attr="onclick=|fillModalEliminarCategoria('${grupo.id}','${cat.id}')|" -->
                          <svg class="svg-icon remove"><use xlink:href="#delete-icon"></use></svg>
                        </button>
                    </div>
                  </div>
                </div> <!-- end categorias -->
              </div> <!-- end card -->
            </div>
          </div> <!-- end row -->
      
        </div><!-- end categoria container -->
      </div> <!-- end container-fluid -->

    </main>

    <!------------------------------------->
    <!-- MODALES (CREAR/EDITAR/ELIMINAR) -->
    <!------------------------------------->

    <!-- MODALES PARA LOS GRUPOS -->

    <!-- Modal CREAR GRUPO -->
    <div class="modal fade" id="modal-añadir-grupo" role="dialog" tabindex="-1" aria-labelledby="modalNuevoGrupo" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Crear grupo de categorías</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-error d-none" role="alert" id="modal-alert">
              A simple danger alert—check it out!
            </div>
            <form id="formCreateGrupo" method="POST" th:action="@{/grupos/crear}">
              <label class="p-0 mb-1" for="nombre">Nombre</label>
              <div class="form-group">
                <input
                id="nombreCreateGroup"
                type="text"
                class="form-control"
                maxlength="35"
                pattern=".*\S.*"
                required
                name="nombre"
                />
                <!-- placeholder="Defina un nombre para la nueva categoría" -->
              </div>
                
              <p class="mt-3">Elige un color distintivo</p>
              <div id="colorPickerGN" class="colorPicker mb-3">
                <input 
                  th:each="color : ${colores}"
                  type="radio"
                  th:value="${color.id}"
                  name="color_id"
                  th:id="|color_${color.nombre}_grupo|"
                />
                <label 
                  th:each="color : ${colores}" 
                  th:attr="style=|background-color: hsl(${color.h}, ${color.s}%, ${color.l}%);|"
                  th:text="${color.nombre}"
                  th:for="|color_${color.nombre}_grupo|"
                >
                </label> 
              </div>
            </form>  
          </div>
          <div class="modal-footer d-inline-block">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="submit" form="formCreateGrupo" class="btn btn-success">Guardar</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal EDITAR GRUPO -->
    <div class="modal fade" id="modal-editar-grupo" role="dialog" tabindex="-1" aria-labelledby="modalEditarGrupo" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Editar grupo de categorías</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-error d-none" role="alert" id="modal-alert">
              A simple danger alert—check it out!
            </div>
            <form id="formEditGrupo" method="POST">
              <label class="p-0 mb-1" for="nombre">Nombre</label>
              <div class="form-group">
                <input
                id="nombreEditGrupo"
                type="text"
                class="form-control"
                maxlength="35"
                pattern=".*\S.*"
                required
                name="nombre"
                />
                <!-- placeholder="Defina un nombre para la nueva categoría" -->
              </div>
                
              <p class="mt-3">Elige un color distintivo</p>
              <div id="colorPickerGE" class="colorPicker mb-3">
                <input 
                  th:each="color : ${colores}"
                  type="radio"
                  th:value="${color.id}"
                  name="color_id"
                  th:id="|color_${color.nombre}_editarGrupo|"
                />
                <label 
                  th:each="color : ${colores}" 
                  th:attr="style=|background-color: hsl(${color.h}, ${color.s}%, ${color.l}%);|"
                  th:text="${color.nombre}"
                  th:for="|color_${color.nombre}_editarGrupo|"
                >
                </label> 
              </div>
            </form>  
          </div>
          <div class="modal-footer d-inline-block">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="submit" form="formEditGrupo" class="btn btn-success">Guardar cambios</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal (confirmación para ELIMINAR GRUPO) -->
    <div class="modal fade" id="modal-eliminar-grupo" tabindex="-1" role="dialog" aria-labelledby="ModalRemoveGroupConfirmation" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              Eliminar Grupo de Categorías
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center">
              <h4 class="mt-1 mb-3">¿Está seguro que desea eliminar este grupo?</h4>
              <svg class='svg-icon warning-icon'><use xlink:href='#warning-icon'></use></svg>
              <p class="d-inline-block mt-2">(Se borrarán también sus categorías)</p>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Cancelar
            </button>
            <form id="formDeleteGrupo" method="POST">
              <button type="submit" class="btn btn-danger" id="modal-btn-eliminar">
                Eliminar Grupo
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>


    <!-- MODALES PARA CATEGORIAS -->
  
    <!-- Modal Nueva Categoría -->
    <div class="modal fade" id="modal-añadir-categoria" role="dialog" tabindex="-1" aria-labelledby="modalNuevaCategoria" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Crear Categoría</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-error d-none" role="alert" id="modal-alert">
              A simple danger alert—check it out!
            </div>
            <form id="formNuevaCategoria" th:action="@{/categorias/crear}" method="POST">
              <label class="p-0 mb-1" for="nombre">Nombre</label>
              <div class="form-group">
                <input
                id="nombreCreate"
                type="text"
                class="form-control"
                maxlength="35"
                pattern=".*\S.*"
                required
                name="nombre"
                />
                <!-- placeholder="Defina un nombre para la nueva categoría" -->
              </div>
              <label id="groupListLabel_NuevaCategoria" class="p-0 mb-1" for="nombre">Grupo al que pertenece</label>
              <div class="form-group">
                <select 
                  class="form-control custom-select-modal"
                  id="groups_ModalCN"
                  name="grupo_id" required>
                  <!-- th:attr="onchange=|selectGroupColorInColorPicker(value)|" -->
                  <option
                    th:each="grupo : ${gruposDeCategorias}"
                    th:if="${grupo.nombre == 'Sin Agrupar'}"
                    th:value="${grupo.id}"
                    th:text="Ninguno"
                    th:data-group-color="0"
                    selected
                  ></option>
                  <option
                    th:each="grupo : ${gruposDeCategorias}"
                    th:unless="${grupo.nombre == 'Sin Agrupar'}"
                    th:value="${grupo.id}"
                    th:text="${grupo.nombre}"
                    th:data-group-color="${grupo.color.id}"
                  ></option> 
                </select>
                <!-- <label id="autoresListEditLabel" class="form-control-placeholder edit-floating-label p-0" for="grupo_id">Grupo al que pertenece</label> -->
                <span class="select_crear_entidad">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#modal-añadir-grupo" data-bs-dismiss="modal"> Crear nuevo grupo.</a>
                </span>
              </div>
                
              <p id="pickColorLabel_CN" class="mt-3">Elige un color distintivo</p>
              <div id="colorPickerCN" class="colorPicker mb-3">
                <input 
                  th:each="color : ${colores}"
                  type="radio"
                  th:value="${color.id}"
                  name="color_id"
                  th:id="|color_${color.nombre}|"
                />
                  <!--th:id="'color' + ${iterStat.count}"-->
                <label 
                  th:each="color : ${colores}" 
                  th:attr="style=|background-color: hsl(${color.h}, ${color.s}%, ${color.l}%);|"
                  th:text="${color.nombre}"
                  th:for="|color_${color.nombre}|"
                >
                </label> 
                  <!--th:for="'color' + ${iterStat.count}"-->
              </div>

            </form>  

          </div>
          <div class="modal-footer d-inline-block">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="submit" form="formNuevaCategoria" class="btn btn-success">Guardar</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal EDITAR Categoría -->
    <div class="modal fade" id="modal-editar-categoria" role="dialog" tabindex="-1" aria-labelledby="modalEditarCategoria" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Editar Categoría</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="alert alert-error d-none" role="alert" id="modal-alert">
              A simple danger alert—check it out!
            </div>
            <form id="formEditarCategoria" method="POST">
              <label class="p-0 mb-1" for="nombre">Nombre</label>
              <div class="form-group">
                <input
                id="nombreEditCategoria"
                type="text"
                class="form-control"
                maxlength="35"
                pattern=".*\S.*"
                required
                name="nombre"
                />
              </div>
              <label id="groupListLabel_EditarCategoria" class="p-0 mb-1" for="nombre">Grupo al que pertenece</label>
              <div class="form-group">
                <select 
                  class="form-control custom-select-modal"
                  id="groups_ModalCE"
                  name="grupo_id" required>
                  <option
                    th:each="grupo : ${gruposDeCategorias}"
                    th:if="${grupo.nombre == 'Sin Agrupar'}"
                    th:value="${grupo.id}"
                    th:text="Ninguno"
                    th:attr="onclick=|setColorInEditModalColorPicker('2','0')|"
                    th:data-group-color="0"
                    selected
                  ></option>
                  <option
                    th:each="grupo : ${gruposDeCategorias}"
                    th:unless="${grupo.nombre == 'Sin Agrupar'}"
                    th:value="${grupo.id}"
                    th:text="${grupo.nombre}"
                    th:attr="onclick=|setColorInEditModalColorPicker('${grupo.id}','${grupo.color.id}')|"
                    th:data-group-color="${grupo.color.id}"
                  ></option> 
                </select>
                <span class="select_crear_entidad">
                    <a href="#" data-bs-toggle="modal" data-bs-target="#modal-añadir-grupo" data-bs-dismiss="modal"> Crear nuevo grupo.</a>
                </span>
              </div>
                
              <p id="pickColorLabel_CE" class="mt-3">Elige un color distintivo</p>
              <div id="colorPickerCE" class="colorPicker mb-3">
                <input 
                  th:each="color : ${colores}"
                  type="radio"
                  th:value="${color.id}"
                  name="color_id"
                  th:id="|color_${color.nombre}_editarCategoria|"
                />
                <label 
                  th:each="color : ${colores}" 
                  th:attr="style=|background-color: hsl(${color.h}, ${color.s}%, ${color.l}%);|"
                  th:text="${color.nombre}"
                  th:for="|color_${color.nombre}_editarCategoria|"
                >
                </label> 
              </div>

            </form>  

          </div>
          <div class="modal-footer d-inline-block">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
              <button type="submit" form="formEditarCategoria" class="btn btn-success">Guardar cambios</button>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- Modal (confirmación para eliminar categoría) -->
    <div class="modal fade" id="modal-eliminar-categoria" tabindex="-1" role="dialog" aria-labelledby="ModalRemoveConfirmation" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">
              Eliminar Categoría
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body text-center">
              <h4 class="mt-1 mb-3">¿Está seguro que desea eliminar esta categoría?</h4>
              <svg class='svg-icon warning-icon'><use xlink:href='#warning-icon'></use></svg>
              <p class="d-inline-block mt-2">(Se borrarán también los gastos asociados)</p>
          </div>
          <div class="modal-footer d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Cancelar
            </button>
            <form id="formDeleteCategoria" method="POST">
              <button type="submit" class="btn btn-danger" id="modal-btn-eliminar">
                Eliminar Categoría
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    


    <!--===== JQUERY + BOOTSTRAP JS =====-->
    <!--<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>--> 
    <!--<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/lib/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>-->

    <script type="text/javascript" th:src="@{/lib/jquery-3.5.1.min.js}"></script>
    <script type="text/javascript" th:src="@{/lib/bootstrap.bundle.min.js}"></script>
     
    <!--===== CUSTOM js SCRIPTS =====-->
    <script type="text/javascript" th:src="@{/js/sidebar.js}"></script>
    <script type="text/javascript" th:src="@{/js/searchBoxBasics.js}"></script>
    <script type="text/javascript" th:src="@{/js/searchBoxCategorias.js}"></script>
    <script type="text/javascript" th:src="@{/js/colorPicker.js}"></script>

    
    <script>
      // back to top button
      $('#toTopBtn').fadeOut();
      $(window).scroll(function() {
          ($(this).scrollTop() > 150) ? $('#toTopBtn').fadeIn() : $('#toTopBtn').fadeOut();
      });
      
      $("#btn-collapse-categorias").on('click', function(){
        $(".divider").toggleClass('d-none');
       ($(this).prop('title') == 'Ocultar categorías') ? $(this).prop('title','Mostrar categorías') : $(this).prop('title','Ocultar categorías')
      });
      
      /* === Populate the remove modals and define the specific actions of the form === */
      function fillModalEliminarGrupo(groupId){
        $('#formDeleteGrupo').attr('action','/grupos/eliminar/' + groupId );
      }

      function fillModalEliminarCategoria(categoriaId){
        $('#formDeleteCategoria').attr('action','/categorias/eliminar/' + categoriaId ); 
      }
    </script>
	
  <script>
    //Floating labels & styling of input fields based on its validity
    $(document).ready(function() {

    //     let formSelects = $('.form-group select');
    // //    let formSelects = $('#modal-add-book select');
        
    //     formSelects.each(function(){
    //         let select = $(this);
    
    //         select.change( () => {
    //             let options = select.find('option');
    //             let label = select.next();
    
    //             label.addClass('floating-label');
    //             select.removeClass("invalid");
    //             select.addClass("valid");
            
    //             options.each(function() {
    //                 if(this.selected && this.value === ""){
    //                     label.removeClass('floating-label');
    //                     select.removeClass("valid");
    //                     select.addClass("invalid");
    //                 }
    //             });        
    //         });
    //     }); 
    
       
      let formInputContainers = $('.form-group');
      
      formInputContainers.each(function() {
        let inputContainer = $(this);
        let input = inputContainer.find('input');
        let label = inputContainer.find('label');
        
        function checkInput() {
            
          let valueLength = input.val().length;
          
          if (valueLength > 0 ) { label.addClass('floating-label'); } 
          else                  { label.removeClass('floating-label'); }
          
          if ( input.is(":valid")){
              input.removeClass("invalid");
              input.addClass("valid");
          }else{
              input.removeClass("valid");
              input.addClass("invalid");
          }
        }
        
        input.change(() => checkInput());
      });
    });

</script>

  </body>
</html>